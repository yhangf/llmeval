# 气泡提示功能说明

## 📖 功能概述

本系统已成功集成了智能气泡提示功能，当用户将鼠标悬停在关键词语上时，会自动显示相关的评分规则解释。

## 🎯 主要特性

### 1. 智能评分规则解释
根据用户要求，气泡提示会根据不同情况显示相应的评分规则：

#### **总分计算规则**：
- **有标准答案**：根据子问题权重加权平均计算  
  `总分 = Σ(子问题分数 × 权重)`
- **无标准答案**：由三个维度平均计算  
  `总分 = (准确性 + 完整性 + 清晰度) ÷ 3`
- **未完成需求**：直接为 0 分

#### **评分维度解释**：
- **准确性**：代码逻辑是否正确，能否正确实现所需功能
- **完整性**：是否包含了题目要求的所有功能  
- **清晰度**：代码结构是否清晰，命名是否规范

#### **其他术语解释**：
- **评估模型**：用于评估答案质量的大语言模型
- **标准答案**：题目的参考答案，用于对比评估
- **需求完成情况**：判断是否完成了题目的基本要求
- **权重**：该子问题在总分中所占的比重

## 🛠️ 技术实现

### 1. 核心组件

#### TooltipManager 类
位置：`static/js/modules/tooltip-manager.js`

主要功能：
- 管理所有工具提示内容和规则
- 根据上下文动态生成提示内容
- 智能检测页面中的关键词并添加提示

#### CSS 样式
位置：`static/css/style.css`

新增样式类：
- `.tooltip-term`：带工具提示的文本样式
- `.tooltip-bubble`：气泡提示框样式
- 支持不同位置的气泡（上方、左侧、右侧）
- 响应式设计，适配移动设备

### 2. 集成方式

#### UI组件集成
在 `static/js/modules/ui-components.js` 中：
- 导入 TooltipManager
- 在生成任务详情HTML时自动添加工具提示
- 为评估结果表格的列标题添加提示

#### 自动应用机制
- 页面加载后自动检测关键词
- 在模态框显示任务详情时自动应用提示
- 根据任务上下文（是否有标准答案、需求完成情况）动态调整提示内容

## 🎨 视觉效果

### 样式特点
- **触发方式**：鼠标悬停显示，移开隐藏
- **视觉标识**：关键词下方有蓝色虚线
- **气泡样式**：深色背景，白色文字，圆角边框
- **动画效果**：平滑的淡入淡出效果
- **位置智能**：根据页面位置自动调整气泡方向

### 交互体验
- 悬停延迟：即时显示，无延迟
- 消失延迟：鼠标移开后立即隐藏
- 层级管理：确保气泡在最顶层显示
- 避免遮挡：智能选择气泡位置

## 📱 响应式支持

### 移动设备适配
- 气泡大小自动调整
- 字体大小响应式缩放
- 最大宽度限制，防止溢出
- 触摸设备兼容性

## 🔧 使用方法

### 1. 开发者使用

#### 创建带工具提示的文本
```javascript
const tooltipManager = new TooltipManager();
const tooltipElement = tooltipManager.createTooltipElement(
    '总分',          // 显示文本
    '总分',          // 工具提示键名
    {               // 上下文信息
        hasStandardAnswer: true,
        requirementCompleted: true
    },
    'default'       // 气泡位置
);
```

#### 批量添加表格工具提示
```javascript
const columnMappings = {
    '准确性': '准确性',
    '完整性': '完整性',
    '清晰度': '清晰度',
    '总分': '总分'
};
tooltipManager.addTooltipsToTable('.table', columnMappings, context);
```

#### 智能检测并添加工具提示
```javascript
tooltipManager.autoDetectAndAddTooltips('.container', context);
```

### 2. 用户使用

#### 查看工具提示
1. 在评估结果页面，将鼠标悬停在带虚线的关键词上
2. 气泡会自动显示相应的解释
3. 鼠标移开时气泡自动消失

#### 常见工具提示位置
- **评估结果表格**：列标题（准确性、完整性、清晰度、总分）
- **任务信息**：评估模型、标准答案、需求完成情况
- **评分详情**：具体分数值的计算说明

## 🧪 测试页面

### 独立测试页面
文件：`tooltip-test.html`

功能：
- 展示所有工具提示效果
- 可以手动应用和清除工具提示
- 模拟真实的评估结果页面

使用方法：
1. 在浏览器中打开 `tooltip-test.html`
2. 点击"应用工具提示"按钮
3. 悬停在蓝色虚线文字上查看效果
4. 点击"清除工具提示"测试清除功能

## 🚀 部署说明

### 文件清单
新增文件：
- `static/js/modules/tooltip-manager.js` - 工具提示管理器
- `tooltip-test.html` - 测试页面
- `气泡提示功能说明.md` - 本说明文档

修改文件：
- `static/css/style.css` - 添加气泡样式
- `static/js/modules/ui-components.js` - 集成工具提示功能

### 激活方式
功能已自动集成到主系统中，无需额外配置。当用户查看任务详情时，工具提示会自动应用。

## 🔮 扩展性

### 添加新的工具提示
在 `TooltipManager` 的 `initializeTooltips()` 方法中添加：
```javascript
this.tooltips.set('新关键词', {
    description: '关键词的解释说明'
});
```

### 自定义气泡样式
修改 `static/css/style.css` 中的 `.tooltip-bubble` 类样式。

### 动态更新工具提示内容
```javascript
tooltipManager.updateTooltip('关键词', {
    description: '新的解释内容'
});
```

## 📋 注意事项

1. **性能优化**：工具提示通过异步方式应用，不会阻塞页面渲染
2. **内存管理**：页面切换时会自动清理工具提示，避免内存泄漏
3. **浏览器兼容**：支持现代浏览器，IE11+
4. **SEO友好**：工具提示不影响搜索引擎爬虫
5. **无障碍访问**：支持键盘导航和屏幕阅读器

## 🔧 问题修复记录

### 修复问题1：气泡被遮挡
**问题描述**：工具提示气泡被其他UI元素遮挡，无法正常显示

**解决方案**：
- 提高气泡的z-index到99999，确保在最顶层显示
- 为表格标题添加特殊的overflow处理
- 优化不同位置气泡的层级管理

### 修复问题2：总分数字不需要解释
**问题描述**：用户不希望为每个总分数字添加工具提示

**解决方案**：
- 移除了对总分数字的动态工具提示生成
- 只保留表格标题的工具提示
- 简化了setupAdditionalTooltips方法

### 修复问题3：气泡完全不显示
**问题描述**：有焦点但气泡不显示内容

**解决方案**：
- 移除了可能影响悬停检测的pointer-events属性
- 修复了不同位置气泡的transform冲突
- 优化了CSS选择器和悬停状态管理
- 改进了表格中工具提示的定位

## ✅ 验证清单

- [x] 总分根据是否有标准答案显示不同计算方式
- [x] 未完成需求时显示0分说明
- [x] 准确性、完整性、清晰度有明确定义
- [x] 支持不同位置的气泡显示
- [x] 响应式设计适配移动设备
- [x] 自动集成到现有评估结果页面
- [x] 修复气泡遮挡问题，确保正常显示
- [x] 移除总分数字的工具提示
- [x] 修复悬停状态检测问题
- [x] 完整的开发文档和使用说明

---

**总结**：气泡提示功能已成功实现并集成到大模型评估系统中，为用户提供了直观的评分规则解释，大大提升了系统的易用性和专业性。 